<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Christmas Tree</title>
  <style>
    :root {
      --bg1: #0b1026;
      --bg2: #0f243b;
      --snow: rgba(255, 255, 255, 0.9);
      --gold: #ffd166;
      --green1: #0dba68;
      --green2: #0a8a50;
      --string: #13402d;
    }
    * { box-sizing: border-box; }
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.05), transparent 32%),
                  radial-gradient(circle at 80% 20%, rgba(255,255,255,0.04), transparent 32%),
                  linear-gradient(160deg, #030712 0%, #0e1f3b 45%, #08152b 100%);
      color: #f7f8fb;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #scene {
      position: relative;
      width: min(92vw, 960px);
      height: min(96vh, 980px);
      aspect-ratio: 1 / 1.05;
      filter: drop-shadow(0 10px 25px rgba(0, 0, 0, 0.35));
    }
    canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }
    .greeting {
      position: absolute;
      top: 5%;
      width: 100%;
      text-align: center;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-weight: 700;
      color: #e2ecff;
      text-shadow: 0 0 14px rgba(255, 255, 255, 0.25);
      user-select: none;
      pointer-events: none;
      font-size: clamp(16px, 2vw, 22px);
    }
    .footer {
      position: absolute;
      bottom: 6%;
      width: 100%;
      text-align: center;
      font-size: clamp(14px, 1.6vw, 18px);
      color: rgba(255, 255, 255, 0.8);
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.45);
      user-select: none;
      pointer-events: none;
    }
    .footer b { color: var(--gold); }
  </style>
</head>
<body>
  <div id="scene">
    <div class="greeting">Merry Christmas & Happy New Year</div>
    <canvas id="tree"></canvas>
    <canvas id="snow"></canvas>
    <div class="footer">Click anywhere to sprinkle more <b>lights</b></div>
  </div>
  <script>
    const treeCanvas = document.getElementById("tree");
    const snowCanvas = document.getElementById("snow");
    const tctx = treeCanvas.getContext("2d");
    const sctx = snowCanvas.getContext("2d");

    let w, h, cx, cy;
    const branchLayers = 10;
    const ornaments = [];
    const snowflakes = [];
    const stars = [];
    const fireflies = [];

    const colors = ["#ff6b6b", "#ffd166", "#74c0fc", "#b197fc", "#63e6be", "#f06595"];

    function resize() {
      w = treeCanvas.width = snowCanvas.width = treeCanvas.clientWidth;
      h = treeCanvas.height = snowCanvas.height = treeCanvas.clientHeight;
      cx = w / 2;
      cy = h * 0.18;
      buildStars();
      initFireflies();
    }
    window.addEventListener("resize", resize);
    resize();

    function drawTree(time) {
      const sway = Math.sin(time * 0.0012) * w * 0.01;

      // Tree layers
      for (let i = 0; i < branchLayers; i++) {
        const progress = i / (branchLayers - 1);
        const layerHeight = h * 0.07 + progress * h * 0.07;
        const layerWidth = w * 0.12 + progress * w * 0.32;
        const y = cy + i * h * 0.07;
        const x = cx + sway * (1 - progress);

        const grad = tctx.createLinearGradient(x, y - layerHeight, x, y + layerHeight);
        grad.addColorStop(0, "#0c9b5a");
        grad.addColorStop(1, "#0f7a4a");

        tctx.fillStyle = grad;
        tctx.beginPath();
        tctx.moveTo(x, y - layerHeight);
        tctx.lineTo(x - layerWidth / 2, y + layerHeight);
        tctx.lineTo(x + layerWidth / 2, y + layerHeight);
        tctx.closePath();
        tctx.shadowBlur = 40;
        tctx.shadowColor = "rgba(12, 255, 170, 0.25)";
        tctx.fill();
      }

      drawTrunk(sway);
      drawStar(time, sway);
      drawGarlands(time, sway);
      drawOrnaments(time);
    }

    function drawTrunk(sway) {
      const trunkWidth = w * 0.06;
      const trunkHeight = h * 0.10;
      tctx.fillStyle = "#4b2e18";
      tctx.shadowBlur = 0;
      tctx.fillRect(cx - trunkWidth / 2 + sway * 0.6, cy + branchLayers * h * 0.07 - h * 0.02, trunkWidth, trunkHeight);
    }

    function drawStar(time, sway) {
      const size = w * 0.035;
      const pulse = 0.7 + 0.3 * Math.sin(time * 0.004);
      tctx.save();
      tctx.translate(cx + sway, cy - h * 0.06);
      tctx.rotate(-Math.PI / 2);
      tctx.scale(pulse, pulse);
      tctx.beginPath();
      for (let i = 0; i < 5; i++) {
        const angle = i * (Math.PI * 2) / 5;
        const r = i % 2 === 0 ? size : size * 0.45;
        tctx.lineTo(Math.cos(angle) * r, Math.sin(angle) * r);
      }
      tctx.closePath();
      const grad = tctx.createRadialGradient(0, 0, size * 0.1, 0, 0, size);
      grad.addColorStop(0, "#fff4c2");
      grad.addColorStop(1, "#e6a700");
      tctx.fillStyle = grad;
      tctx.shadowBlur = 35;
      tctx.shadowColor = "rgba(255, 215, 102, 0.8)";
      tctx.fill();
      tctx.restore();
    }

    function drawGarlands(time, sway) {
      tctx.lineWidth = 3;
      const waves = 6;
      tctx.shadowBlur = 8;
      tctx.shadowColor = "rgba(255,255,255,0.35)";
      for (let i = 0; i < waves; i++) {
        const y = cy + (i + 1) * h * 0.08;
        const width = w * (0.14 + i * 0.05);
        const amp = 6 + i * 1.2;
        const hue = 130 + i * 10;
        tctx.beginPath();
        for (let x = cx - width / 2; x <= cx + width / 2; x += 8) {
          const t = (x - (cx - width / 2)) / width;
          const yOffset = Math.sin(t * Math.PI * 3 + i + time * 0.0015) * amp;
          const px = x + sway * (0.4 - t);
          const py = y + yOffset;
          if (x === cx - width / 2) tctx.moveTo(px, py);
          else tctx.lineTo(px, py);
          // bulbs
          if (x % 28 === 0) {
            const pulse = 0.5 + 0.5 * Math.sin(time * 0.004 + x * 0.05 + i);
            tctx.save();
            tctx.fillStyle = `hsl(${hue + (x % 2 === 0 ? 40 : -40)}, 80%, ${60 + pulse * 20}%)`;
            tctx.shadowBlur = 18;
            tctx.shadowColor = tctx.fillStyle;
            tctx.beginPath();
            tctx.arc(px, py, 4 + pulse * 1.2, 0, Math.PI * 2);
            tctx.fill();
            tctx.restore();
          }
        }
        tctx.strokeStyle = `rgba(220,255,235,${0.18 + i * 0.02})`;
        tctx.stroke();
      }
    }

    function drawOrnaments(time) {
      for (const o of ornaments) {
        const twinkle = 0.6 + 0.4 * Math.sin(time * 0.006 + o.seed);
        const r = o.r * twinkle;
        tctx.beginPath();
        tctx.fillStyle = o.color;
        tctx.shadowBlur = 18;
        tctx.shadowColor = o.glow;
        tctx.arc(o.x, o.y, r, 0, Math.PI * 2);
        tctx.fill();
      }
    }

    function addRandomOrnaments(count = 25) {
      for (let i = 0; i < count; i++) {
        const layer = Math.random() * (branchLayers - 1);
        const progress = layer / (branchLayers - 1);
        const layerWidth = w * (0.12 + progress * 0.32);
        const layerHeight = h * (0.07 + progress * 0.07);
        const y = cy + layer * h * 0.07 + layerHeight * 0.2 + Math.random() * layerHeight * 0.5;
        const x = cx + (Math.random() - 0.5) * layerWidth;
        const color = colors[Math.floor(Math.random() * colors.length)];
        ornaments.push({
          x,
          y,
          r: 5 + Math.random() * 5,
          color,
          glow: color + "cc",
          seed: Math.random() * Math.PI * 2
        });
      }
    }

    function initSnow() {
      const total = 160;
      snowflakes.length = 0;
      for (let i = 0; i < total; i++) {
        snowflakes.push(makeSnowflake());
      }
    }

    function makeSnowflake() {
      return {
        x: Math.random() * w,
        y: Math.random() * h,
        r: 1 + Math.random() * 2.5,
        speed: 0.7 + Math.random() * 1.6,
        drift: (Math.random() - 0.5) * 0.6,
        phase: Math.random() * Math.PI * 2
      };
    }

    function drawSnow() {
      sctx.clearRect(0, 0, w, h);
      sctx.fillStyle = "white";
      for (const f of snowflakes) {
        f.y += f.speed;
        f.x += Math.sin(f.phase + f.y * 0.01) * f.drift;
        if (f.y > h) {
          f.y = -5;
          f.x = Math.random() * w;
        }
        if (f.x < 0) f.x = w;
        if (f.x > w) f.x = 0;
        sctx.beginPath();
        sctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
        sctx.fillStyle = `rgba(255,255,255,${0.6 + Math.random() * 0.3})`;
        sctx.fill();
      }
    }

    function buildStars() {
      stars.length = 0;
      const count = 120;
      for (let i = 0; i < count; i++) {
        stars.push({
          x: Math.random() * w,
          y: Math.random() * h * 0.55,
          size: Math.random() * 1.8 + 0.5,
          phase: Math.random() * Math.PI * 2
        });
      }
    }

    function drawBackground(time) {
      tctx.clearRect(0, 0, w, h);
      const sky = tctx.createLinearGradient(0, 0, 0, h);
      sky.addColorStop(0, "#050917");
      sky.addColorStop(0.5, "#0c1c33");
      sky.addColorStop(1, "#0c1a2c");
      tctx.fillStyle = sky;
      tctx.fillRect(0, 0, w, h);

      // aurora ribbons
      for (let i = 0; i < 3; i++) {
        const yBase = h * (0.12 + i * 0.07);
        const hue = 120 + i * 20;
        tctx.beginPath();
        for (let x = 0; x <= w; x += 24) {
          const y = yBase + Math.sin(x * 0.01 + time * 0.001 + i) * 22;
          if (x === 0) tctx.moveTo(x, y);
          else tctx.lineTo(x, y);
        }
        tctx.strokeStyle = `hsla(${hue}, 70%, 65%, 0.22)`;
        tctx.lineWidth = 28;
        tctx.stroke();
      }

      // stars twinkling
      for (const s of stars) {
        const tw = 0.4 + 0.6 * Math.sin(time * 0.002 + s.phase);
        tctx.fillStyle = `rgba(255,255,255,${tw})`;
        tctx.beginPath();
        tctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
        tctx.fill();
      }

      // halo behind tree
      const halo = tctx.createRadialGradient(cx, h * 0.32, 0, cx, h * 0.32, w * 0.42);
      halo.addColorStop(0, "rgba(90,255,200,0.20)");
      halo.addColorStop(1, "rgba(10,30,20,0)");
      tctx.fillStyle = halo;
      tctx.fillRect(0, 0, w, h);
    }

    function drawGround(time) {
      const baseY = cy + branchLayers * h * 0.07 + h * 0.07;
      const grad = tctx.createLinearGradient(0, baseY - 50, 0, h);
      grad.addColorStop(0, "rgba(255,255,255,0.4)");
      grad.addColorStop(1, "rgba(255,255,255,0.12)");
      tctx.fillStyle = grad;
      tctx.beginPath();
      tctx.moveTo(0, baseY);
      tctx.quadraticCurveTo(w * 0.25, baseY - 25, w * 0.5, baseY - 5 + Math.sin(time * 0.002) * 5);
      tctx.quadraticCurveTo(w * 0.75, baseY + 20, w, baseY - 10);
      tctx.lineTo(w, h);
      tctx.lineTo(0, h);
      tctx.closePath();
      tctx.fill();
    }

    function initFireflies() {
      fireflies.length = 0;
      for (let i = 0; i < 28; i++) {
        fireflies.push({
          x: cx + (Math.random() - 0.5) * w * 0.35,
          y: cy + h * 0.1 + Math.random() * h * 0.45,
          r: 1.4 + Math.random() * 2,
          speed: 0.2 + Math.random() * 0.5,
          drift: (Math.random() - 0.5) * 0.3,
          phase: Math.random() * Math.PI * 2
        });
      }
    }

    function drawFireflies(time) {
      for (const f of fireflies) {
        f.x += Math.sin(time * 0.001 + f.phase) * f.drift;
        f.y += Math.cos(time * 0.0012 + f.phase) * f.speed * 0.5;
        if (f.x < cx - w * 0.45) f.x = cx + w * 0.45;
        if (f.x > cx + w * 0.45) f.x = cx - w * 0.45;
        if (f.y < cy) f.y = cy + h * 0.45;
        if (f.y > cy + h * 0.5) f.y = cy + h * 0.1;
        const glow = 0.4 + 0.6 * Math.sin(time * 0.005 + f.phase);
        tctx.beginPath();
        tctx.fillStyle = `rgba(255, 220, 120, ${glow})`;
        tctx.shadowBlur = 25;
        tctx.shadowColor = "rgba(255, 220, 120, 0.7)";
        tctx.arc(f.x, f.y, f.r + glow * 1.5, 0, Math.PI * 2);
        tctx.fill();
      }
    }

    function loop() {
      const time = performance.now();
      drawBackground(time);
      drawTree(time);
      drawGround(time);
      drawFireflies(time);
      drawSnow();
      requestAnimationFrame(loop);
    }

    addRandomOrnaments(50);
    initSnow();
    loop();

    treeCanvas.addEventListener("click", sprinkleLights);
    snowCanvas.addEventListener("click", sprinkleLights);
    document.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      sprinkleLights(touch);
    });

    function sprinkleLights(e) {
      const rect = treeCanvas.getBoundingClientRect();
      const x = (e.clientX ?? e.pageX) - rect.left;
      const y = (e.clientY ?? e.pageY) - rect.top;
      for (let i = 0; i < 10; i++) {
        const jitterX = x + (Math.random() - 0.5) * 40;
        const jitterY = y + (Math.random() - 0.5) * 40;
        ornaments.push({
          x: jitterX,
          y: jitterY,
          r: 4 + Math.random() * 5,
          color: colors[Math.floor(Math.random() * colors.length)],
          glow: colors[Math.floor(Math.random() * colors.length)] + "cc",
          seed: Math.random() * Math.PI * 2
        });
      }
    }
  </script>
</body>
</html>

